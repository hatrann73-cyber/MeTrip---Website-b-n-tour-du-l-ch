<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MeTrip - Đăng nhập</title>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Crimson+Pro:wght@400;600;700;900&family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">

    <!-- Icons -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link rel="stylesheet" href="../css/hfstyle.css">
    <link rel="stylesheet" href="loginstyle.css">

</head>
<script>
document.addEventListener("DOMContentLoaded", function () {
    const header = document.querySelector(".header");

    if (!header) return;

    window.addEventListener("scroll", () => {
        if (window.scrollY > 50) {
            header.classList.add("header-scrolled");
        } else {
            header.classList.remove("header-scrolled");
        }
    });
});
</script>
<body class="page">

<header class="header">
    <div class="nav-container">
        <a href="../index.html" class="logo">
            <p>MeTrip</p>
        </a>
        <nav class="main-nav">
            <a href="../index.html">TRANG CHỦ</a>
            <a href="../Contact/Contact.html">LIÊN HỆ</a>
            <a href="../Gioithieu/gt.html">GIỚI THIỆU</a>
            <a href="../Blog/Blog.html">BLOG</a>
            <a href="../cart/cart.html">GIỎ HÀNG</a>
        </nav>

        <!-- KHU VỰC NGƯỜI DÙNG -->
        <div class="user-section">
            <!-- Nếu chưa đăng nhập - Hiển thị nút đăng ký/đăng nhập -->
            <div class="auth-buttons" id="authButtons">
                <a href="../Signup/signup.html" class="btn btn-outline">Sign Up</a>
                <a href="../login/login.html" class="btn btn-outline">Login</a>
            </div>
            
            <!-- Nếu đã đăng nhập - Hiển thị avatar và dropdown -->
            <div class="user-avatar-dropdown" id="userAvatarDropdown" style="display: none;">
                <div class="avatar-wrapper" id="avatarTrigger">
                    <img src="../image/home/avatar.jpg" alt="Avatar" class="user-avatar" id="userAvatar">
                    <span class="material-symbols-outlined arrow">expand_more</span>
                </div>
                <div class="dropdown-menu" id="dropdownMenu">
                    <div class="user-info">
                        <p class="user-name" id="dropdownUserName">Người dùng</p>
                        <p class="user-email" id="dropdownUserEmail">user@example.com</p>
                    </div>
                    <div class="dropdown-divider"></div>
                    <a href="../profile/profile.html" class="dropdown-item">
                        <span class="material-symbols-outlined">person</span>
                        Trang cá nhân
                    </a>
                    <a href="../orders/orders.html" class="dropdown-item">
                        <span class="material-symbols-outlined">receipt_long</span>
                        Đơn hàng của tôi
                    </a>
                    <a href="../settings/settings.html" class="dropdown-item">
                        <span class="material-symbols-outlined">settings</span>
                        Cài đặt
                    </a>
                    <div class="dropdown-divider"></div>
                    <a href="#" class="dropdown-item logout" id="logoutBtn">
                        <span class="material-symbols-outlined">logout</span>
                        Đăng xuất
                    </a>
                </div>
            </div>
        </div>
    </div>
</header>
    <!-- LOGIN BOX -->
    <div class="wrapper">
        <div class="login-left">
            <h1>ĐĂNG NHẬP<br>TÀI KHOẢN</h1>
            <p class="sub">Đăng nhập bằng mạng xã hội</p>

            <div class="social">
               <div> <i class="fa-brands fa-facebook"></i></div>
                <div><i class="fa-brands fa-twitter"></i></div>
                <div><i class="fa-brands fa-instagram"></i></div>
            </div>

            <div class="or">HOẶC</div>

            <form id="loginForm">
                <input type="email" id="loginEmail" placeholder="Email" class="input" required>
                <input type="password" id="loginPassword" placeholder="Mật khẩu" class="input" required>
                
                <div class="remember-forgot" style="display: flex; justify-content: space-between; align-items: center; margin: 10px 0;">
                    <label style="display: flex; align-items: center; gap: 5px; font-size: 14px;">
                        <input type="checkbox" id="rememberMe"> Ghi nhớ đăng nhập
                    </label>
                    <a href="#" style="font-size: 14px; color: #4b8ef1; text-decoration: none;">Quên mật khẩu?</a>
                </div>

                <button type="submit" class="btn-login" id="loginBtn">Đăng Nhập</button>
                
                <div id="loginMessage" style="margin-top: 15px; text-align: center; font-size: 14px;"></div>
            </form>
            
            <p style="text-align: center; margin-top: 20px; font-size: 14px;">
                Chưa có tài khoản? <a href="../Signup/signup.html" style="color: #4b8ef1; font-weight: bold;">Đăng ký ngay</a>
            </p>
        </div>

       <div class="login-right">
    <img src="1.jpg" alt="">
    <div class="right-text">
        <h2>NEW HERE?</h2>
        <p>Tạo tài khoản để lưu tour yêu thích và nhận ưu đãi độc quyền.</p>
        <a href="../Signup/signup.html" class="btn-signup">Đăng Ký</a>
    </div>
</div>
    </div>

<!-- Footer -->
    <footer class="footer">
            <div class="footer-container">
                <div class="footer-col">
                    <a href="../index.html" class="f-logo">
                        <p>MeTrip</p>
                    </a>
                    <p class="footer-desc">
                        Trải nghiệm khám phá Việt Nam tuyệt vời dành cho người trẻ thích du lịch, khám phá, kết nối và tạo kỷ niệm.
                    </p>
                </div>

        <div>
            <h3>Liên kết</h3>
            <ul class="footer-links">
                <li><a href="../Gioithieu/gt.html">Giới Thiệu</a> </li>
                <li><a href="../index.html">Trang chủ</a></li>
                <li><a href="../Blog/Blog.html">Blog</a></li>
                <li><a href="../Contact/Contact.html">Liên hệ</a></li>
            </ul>
        </div>

                <div class="footer-col">
                    <h3>Hỗ Trợ</h3>
                    <ul class="footer-links">
                  <li><a href="../FAQ/FAQ.html#popular">Câu hỏi phổ biến</a></li>
                        <li><a href="../FAQ/FAQ.html#booking">Đặt tour & thanh toán</a></li>
                        <li><a href="../FAQ/FAQ.html#exclusive">Dịch vụ độc quyền</a></li>
                        <li><a href="../FAQ/FAQ.html#cancel">Huỷ và đổi lịch</a></li>
                    </ul>
                </div>

                <div class="footer-col">
                    <h3>Theo dõi</h3>
                    <div class="social-icons">
                        <a href="#" class="social-link"><i class="fa-brands fa-twitter"></i></a>
                        <a href="#" class="social-link facebook"><i class="fa-brands fa-facebook-f"></i></a>
                        <a href="#" class="social-link"><i class="fa-brands fa-instagram"></i></a>
                    </div>
                    <div class="contact-info">
                        <p>Email: <a href="mailto:metrip@gmail.com">metrip@gmail.com</a></p>
                        <p>Hotline: <span class="highlight">1900 580 801</span></p>
                    </div>
                </div>
            </div>

            <div class="footer-bottom">
                <p>2025 MeTrip. Tất cả quyền được bảo lưu.</p>
            </div>
    </footer>

<!-- JavaScript cho đăng nhập -->
<script>
<script>
document.addEventListener("DOMContentLoaded", function () {
    const header = document.querySelector(".header");

    if (!header) return;

    window.addEventListener("scroll", () => {
        if (window.scrollY > 50) {
            header.classList.add("header-scrolled");
        } else {
            header.classList.remove("header-scrolled");
        }
    });
});

// ==============================================
// XỬ LÝ ĐĂNG NHẬP - ĐÃ SỬA LỖI TỰ ĐỘNG REDIRECT
// ==============================================
document.addEventListener("DOMContentLoaded", function () {
    const loginForm = document.getElementById("loginForm");
    const loginBtn = document.getElementById("loginBtn");
    const loginMessage = document.getElementById("loginMessage");

    // KHÔNG TỰ ĐỘNG REDIRECT KHI ĐÃ ĐĂNG NHẬP
    // Vẫn cho phép xem trang login để đăng nhập tài khoản khác
    const isLoggedIn = localStorage.getItem("isLoggedIn") === "true";
    if (isLoggedIn) {
        // Hiển thị thông báo nhưng KHÔNG redirect
        loginMessage.innerHTML = `
            <div style="background: #e8f5e9; border: 1px solid #4caf50; border-radius: 8px; padding: 12px; margin: 15px 0;">
                <p style="color: #2e7d32; margin: 0 0 8px 0;">
                    <i class="fa-solid fa-circle-check" style="color: #4caf50; margin-right: 8px;"></i>
                    <strong>Bạn đã đăng nhập rồi!</strong>
                </p>
                <p style="color: #555; font-size: 14px; margin: 0 0 10px 0;">
                    Tài khoản: <strong>${localStorage.getItem("userName") || "Người dùng"}</strong>
                </p>
                <div style="display: flex; gap: 10px;">
                    <a href="../index.html" 
                       style="flex: 1; text-align: center; background: #4caf50; color: white; padding: 8px 12px; border-radius: 6px; text-decoration: none; font-weight: bold;">
                       Về trang chủ
                    </a>
                    <button onclick="logoutFromLoginPage()" 
                            style="flex: 1; background: #f5f5f5; color: #d32f2f; border: 1px solid #ddd; padding: 8px 12px; border-radius: 6px; font-weight: bold; cursor: pointer;">
                        Đăng xuất
                    </button>
                </div>
            </div>
        `;
        
        // Ẩn form đăng nhập nếu muốn
        loginForm.style.opacity = "0.6";
        loginForm.style.pointerEvents = "none";
    }

    // Xử lý đăng nhập
    loginForm.addEventListener("submit", function (e) {
        e.preventDefault();
        
        const email = document.getElementById("loginEmail").value.trim();
        const password = document.getElementById("loginPassword").value.trim();
        const rememberMe = document.getElementById("rememberMe").checked;

        // Kiểm tra input
        if (!email || !password) {
            showMessage("Vui lòng nhập email và mật khẩu!", "error");
            return;
        }

        // Lấy thông tin người dùng từ localStorage
        const savedUser = localStorage.getItem("userAccount");
        
        if (!savedUser) {
            showMessage("Tài khoản không tồn tại. Vui lòng đăng ký!", "error");
            return;
        }

        const user = JSON.parse(savedUser);
        
        // Kiểm tra thông tin đăng nhập
        if (user.email === email && user.password === password) {
            // Đăng nhập thành công
            localStorage.setItem("isLoggedIn", "true");
            localStorage.setItem("userEmail", email);
            localStorage.setItem("userName", user.name);
            localStorage.setItem("userRole", user.role || "new");
            
            if (rememberMe) {
                localStorage.setItem("rememberLogin", "true");
            }

            showMessage("Đăng nhập thành công! Đang chuyển hướng...", "success");
            
            // Chuyển hướng sau 1 giây
            setTimeout(() => {
                const redirectUrl = sessionStorage.getItem("redirectAfterLogin");
                if (redirectUrl) {
                    sessionStorage.removeItem("redirectAfterLogin");
                    window.location.href = redirectUrl;
                } else {
                    window.location.href = "../index.html";
                }
            }, 1000);
            
        } else {
            showMessage("Email hoặc mật khẩu không đúng!", "error");
        }
    });

    // Hiển thị thông báo
    function showMessage(message, type) {
        // Chỉ hiển thị nếu chưa có thông báo đăng nhập rồi
        if (!isLoggedIn) {
            loginMessage.textContent = message;
            loginMessage.style.color = type === "success" ? "#4caf50" : "#f44336";
            loginMessage.style.fontWeight = "bold";
            loginMessage.style.padding = "10px";
            loginMessage.style.borderRadius = "6px";
            loginMessage.style.backgroundColor = type === "success" ? "#e8f5e9" : "#ffebee";
            loginMessage.style.border = type === "success" ? "1px solid #4caf50" : "1px solid #f44336";
            
            setTimeout(() => {
                loginMessage.textContent = "";
                loginMessage.style = "";
            }, 3000);
        }
    }

    // Kiểm tra nếu có lưu thông tin đăng nhập
    if (localStorage.getItem("rememberLogin") === "true" && !isLoggedIn) {
        const savedUser = localStorage.getItem("userAccount");
        if (savedUser) {
            const user = JSON.parse(savedUser);
            document.getElementById("loginEmail").value = user.email || "";
            document.getElementById("rememberMe").checked = true;
        }
    }
});

// Hàm đăng xuất từ trang login
function logoutFromLoginPage() {
    localStorage.removeItem("isLoggedIn");
    localStorage.removeItem("userEmail");
    localStorage.removeItem("userName");
    localStorage.removeItem("rememberLogin");
    
    // Reload trang để hiển thị form đăng nhập bình thường
    location.reload();
}
</script>
</body>
</html>